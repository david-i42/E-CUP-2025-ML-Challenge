# Пайплайн для выявления контрафакта на маркетплейсе

Один из важных аспектов работы маркетплейса - соблюдение законодательства стран, в которых он функционирует.  Для этого требуется, в том числе, предотвращать  продажу  контрафактного товара. От этого также зависит репутация компании. Исходя их этого необходимо составить пайплайн для автоматического выявления контрафактных товаров на маркетплейсе по разнородным источникам сигналов — изображениям, текстам и табличным признакам (метаданные товара, поведение продаж и активности).

Построить ML-пайплайн, который по сочетанию визуальных, текстовых и табличных признаков классифицирует товар как «контрафакт» или «оригинал», с оптимизацией по F1-score и готовностью к применению в продакшене/анализе.


## Стек

- Python 3.10
- Библиотеки для работы с данными - pandas, numpy
- sklearn (предобработка, модели, метрики)
- CatBoost (градиентный бустинг)
- Hugging Face / transformers / BERT (оценка эмоциональности текстов)
- PIL — извлечение разрешения

## Этапы работы

1. Предобработка и очистка данных
    
    - Отфильтровал записи: исключил товары, у которых возвраты превышали продажи.
    - При работе с пропусками провёл:
        - восстановление отсутствующих значений в временных показателях (7, 30, 90 дней) на основе наблюдаемых пропорций.
        - восстановление ItemVarietyCount через агрегацию числа уникальных ID товара по ID продавца.
    
2. Сгенерировал новые признаки
    
    - Рейтинговые столбцов (оценки 1–5) преобразовал во взвешенный рейтинг и вычислил агрегированные показатели (по бренду, названию товара, ID продавца и т.д.).
    - Бины по ценам.
    - Статистические агрегаты цен (среднее, медиана, std и др.) по категориальным признакам.
    - Фичи из строковых полей: количество слов, символов, специальных символов и т.п.
    - Агрегации медийной активности (количество комментариев, фото, видео) по ID продавца.
    - На основе текстового признака - описания товара: степень позитивности описания товара, вычисленная с помощью BERT.
    - Визуальная фича: разрешение изображения в пикселях.
    
3. Отбор признаков
    
    - Разработан класс для подбора оптимального подмножества признаков.
    - Оценка важности признаков:
        - Встроенные методы моделей (feature_importances_ для sklearn-моделей, get_feature_importance для CatBoost).
        - Permutation importance (случайное перемешивание признака и оценка падения качества).
    - Подбор признаков производится на основе значимости для выбранной модели и влияния на F1-score.
    
4. Обучение и валидация модели
    
    - Обучение моделей (включая CatBoost) с кросс-валидацией.
    - Оптимизация гиперпараметров в рамках выбранных моделей.
    - Оценка и выбор финальной модели по F1-score.


В результате был построен ML-пайплайн, объединяющий табличные, текстовые и визуальные признаки для задачи классификации «контрафакт / оригинал». Реализован класс автоматизированного отбора признаков на основе встроенных и пермутационных методов важности.
- Результат пригоден для:
    - Интеграции в мониторинг качества каталога и автоматических систем модерации.
    - Создания набора наиболее подозрительных карточек для ручной проверки.
    - Дальнейшего анализа причин контрафакта и оптимизации бизнес-процессов продавцов.
